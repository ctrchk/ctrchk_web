# å¿«é€Ÿè¨­ç½®ï¼ˆ3 æ­¥é©Ÿè§£æ±ºç™»å…¥å•é¡Œï¼‰

## æ‚¨é‡åˆ°çš„å•é¡Œ

âŒ **è¨»å†Šå¤±æ•—**ï¼šã€ŒThe string did not match the expected patternã€  
âŒ **Google ç™»å…¥å¤±æ•—**ï¼šã€ŒSupabase auth æ–¹æ³•ä¸å¯ç”¨ã€

## åŸå› 

æ‚¨çš„ç¶²ç«™éœ€è¦å…©å€‹å¤–éƒ¨æœå‹™æ‰èƒ½é‹ä½œï¼š
1. **Vercel Postgres** - å„²å­˜ç”¨æˆ¶è³‡æ–™ï¼ˆâŒ å°šæœªè¨­ç½®ï¼‰
2. **Supabase Google OAuth** - è™•ç† Google ç™»å…¥ï¼ˆâŒ å°šæœªå®Œå…¨è¨­ç½®ï¼‰

## è§£æ±ºæ–¹æ³•ï¼ˆ3 å€‹æ­¥é©Ÿï¼‰

### ğŸ“ æ­¥é©Ÿ 1ï¼šå»ºç«‹ Vercel Postgres è³‡æ–™åº«

1. ç™»å…¥ [Vercel Dashboard](https://vercel.com/dashboard)
2. é¸æ“‡æ‚¨çš„å°ˆæ¡ˆ â†’ **Storage** â†’ **Create Database**
3. é¸æ“‡ **Postgres** â†’ é¸æ“‡å€åŸŸï¼ˆHong Kong/Singaporeï¼‰â†’ **Create**
4. ç­‰å¾…å»ºç«‹å®Œæˆå¾Œï¼Œé»æ“Š **Query** æ¨™ç±¤
5. è¤‡è£½ä¸¦åŸ·è¡Œä»¥ä¸‹ SQLï¼š

```sql
CREATE TABLE IF NOT EXISTS users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255),
    user_role VARCHAR(20) DEFAULT 'junior',
    full_name VARCHAR(100),
    phone VARCHAR(20),
    birthdate DATE,
    experience VARCHAR(20),
    bike_type VARCHAR(20),
    preferred_area VARCHAR(50),
    profile_completed BOOLEAN DEFAULT FALSE,
    profile_completion_date TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW(),
    auth_provider VARCHAR(20) DEFAULT 'email',
    google_id VARCHAR(255)
);

CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
CREATE INDEX IF NOT EXISTS idx_users_google_id ON users(google_id);

CREATE TABLE IF NOT EXISTS cycling_history (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
    ride_date DATE NOT NULL,
    distance_km DECIMAL(10, 2),
    route_name VARCHAR(255),
    created_at TIMESTAMP DEFAULT NOW()
);
```

6. é»æ“Š **Run Query** âœ…

---

### ğŸ” æ­¥é©Ÿ 2ï¼šè¨­ç½®ç’°å¢ƒè®Šæ•¸

1. åœ¨ Vercel Dashboard â†’ æ‚¨çš„å°ˆæ¡ˆ â†’ **Settings** â†’ **Environment Variables**
2. é»æ“Š **Add New**ï¼š
   - Name: `JWT_SECRET`
   - Value: ç”Ÿæˆä¸€å€‹éš¨æ©Ÿå­—ä¸²ï¼ˆè‡³å°‘ 32 å­—å…ƒï¼‰
     * å¯ä»¥ç”¨é€™å€‹ç¶²ç«™ç”Ÿæˆï¼šhttps://www.random.org/strings/
     * æˆ–ç”¨å¯†ç¢¼ç”Ÿæˆå™¨ç”Ÿæˆä¸€å€‹å¼·å¯†ç¢¼
   - ç’°å¢ƒï¼šå…¨é¸ï¼ˆProduction, Preview, Developmentï¼‰
3. é»æ“Š **Save**
4. å‰å¾€ **Deployments** â†’ é»æ“Šæœ€æ–°éƒ¨ç½²çš„ **...** â†’ **Redeploy**
5. ç­‰å¾…é‡æ–°éƒ¨ç½²å®Œæˆ âœ…

---

### ğŸ”µ æ­¥é©Ÿ 3ï¼šå•Ÿç”¨ Google ç™»å…¥ï¼ˆSupabaseï¼‰

#### 3.1 å–å¾— Google OAuth æ†‘è­‰

1. å‰å¾€ [Google Cloud Console](https://console.cloud.google.com/)
2. å»ºç«‹æ–°å°ˆæ¡ˆæˆ–é¸æ“‡ç¾æœ‰å°ˆæ¡ˆ
3. å·¦å´é¸å–®ï¼š**APIs & Services** â†’ **Credentials**
4. é»æ“Š **Create Credentials** â†’ **OAuth 2.0 Client ID**
5. æ‡‰ç”¨ç¨‹å¼é¡å‹ï¼š**Web application**
6. åç¨±ï¼š`CTRC HK Web`
7. **Authorized redirect URIs** æ·»åŠ ï¼š
   ```
   https://umpxhvqcldmrmkuipmao.supabase.co/auth/v1/callback
   ```
8. é»æ“Š **Create** â†’ è¤‡è£½ **Client ID** å’Œ **Client Secret**

#### 3.2 åœ¨ Supabase ä¸­è¨­ç½®

1. å‰å¾€ [Supabase Dashboard](https://supabase.com/dashboard)
2. é¸æ“‡å°ˆæ¡ˆï¼š`umpxhvqcldmrmkuipmao`
3. å·¦å´é¸å–®ï¼š**Authentication** â†’ **Providers**
4. æ‰¾åˆ° **Google** â†’ å•Ÿç”¨é–‹é—œ
5. è²¼ä¸Šå‰›æ‰çš„ **Client ID** å’Œ **Client Secret**
6. é»æ“Š **Save** âœ…

#### 3.3 è¨­ç½®é‡å®šå‘ URL

åœ¨ Supabase çš„è¨­å®šä¸­ï¼ˆé€šå¸¸åœ¨ Authentication â†’ URL Configurationï¼‰ï¼š
- Site URL: `https://www.ctrchk.com`
- Redirect URLs: æ·»åŠ  `https://www.ctrchk.com/auth-callback.html`

å›åˆ° Google Cloud Consoleï¼Œç·¨è¼¯æ‚¨çš„ OAuth 2.0 Client IDï¼š
- **Authorized redirect URIs** å†æ·»åŠ ï¼š
  ```
  https://www.ctrchk.com/auth-callback.html
  ```

---

## âœ… å®Œæˆï¼æ¸¬è©¦ä¸€ä¸‹

### æ¸¬è©¦è¨»å†Š
1. å‰å¾€ï¼šhttps://www.ctrchk.com/register.html
2. å¡«å¯«è¨»å†Šè¡¨å–®ï¼ˆå¯†ç¢¼è‡³å°‘ 8 å­—å…ƒï¼‰
3. é»æ“Šã€Œè¨»å†Šä¸¦æˆç‚ºé«˜ç´šæœƒå“¡ã€
4. æ‡‰è©²æˆåŠŸè¨»å†Šä¸¦è·³è½‰åˆ°ç™»å…¥é é¢ âœ…

### æ¸¬è©¦ Google ç™»å…¥
1. å‰å¾€ï¼šhttps://www.ctrchk.com/login.html
2. é»æ“Šã€Œä½¿ç”¨ Google ç™»å…¥ã€
3. é¸æ“‡ Google å¸³è™Ÿä¸¦æˆæ¬Š
4. æ‡‰è©²æˆåŠŸç™»å…¥ âœ…

---

## â“ é‚„æ˜¯ä¸è¡Œï¼Ÿ

### å¸¸è¦‹å•é¡Œå¿«é€Ÿæª¢æŸ¥

**å•é¡Œ 1ï¼šè¨»å†Šæ™‚ä»ç„¶å‡ºç¾éŒ¯èª¤**
- æª¢æŸ¥ï¼šVercel Postgres â†’ Query â†’ åŸ·è¡Œ `SELECT * FROM users LIMIT 1;`
- å¦‚æœå‡ºç¾ã€Œrelation "users" does not existã€â†’ é‡æ–°åŸ·è¡Œæ­¥é©Ÿ 1 çš„ SQL

**å•é¡Œ 2ï¼šGoogle ç™»å…¥å¤±æ•—**
- æª¢æŸ¥ï¼šSupabase â†’ Authentication â†’ Providers â†’ Google æ˜¯å¦å·²å•Ÿç”¨
- æª¢æŸ¥ï¼šGoogle Cloud Console â†’ Credentials â†’ é‡å®šå‘ URI æ˜¯å¦åŒ…å« Supabase çš„ç¶²å€

**å•é¡Œ 3ï¼šè¨­ç½®å¾Œæ²’æœ‰è®ŠåŒ–**
- ç¢ºèªå·²é‡æ–°éƒ¨ç½²ï¼ˆæ­¥é©Ÿ 2.4ï¼‰
- æ¸…é™¤ç€è¦½å™¨å¿«å–ä¸¦é‡æ–°æ•´ç†é é¢

---

## ğŸ“š éœ€è¦æ›´è©³ç´°çš„èªªæ˜ï¼Ÿ

è«‹æŸ¥çœ‹ `è¨­ç½®æŒ‡å—.md` æ–‡ä»¶ï¼Œå…§æœ‰å®Œæ•´çš„åœ–æ–‡èªªæ˜å’Œç–‘é›£æ’è§£ã€‚

---

**è£½ä½œæ—¥æœŸ**ï¼š2025-01-31  
**é©ç”¨æ–¼**ï¼šCTRC HK ç¶²ç«™ç™»å…¥ç³»çµ±
